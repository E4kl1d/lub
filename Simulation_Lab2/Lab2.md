## Комп'ютерні системи імітаційного моделювання
## СПм-24-3, Трембач Богдан Сергійович
### Лабораторна робота №**2**. Редагування імітаційних моделей у середовищі NetLogo

<br>

### Варіант 6, модель у середовищі NetLogo:
[Rabbits Grass Weeds](http://www.netlogoweb.org/launch#http://www.netlogoweb.org/assets/modelslib/Sample%20Models/Biology/Rabbits%20Grass%20Weeds.nlogox)

<br>

### Вербальний опис моделі:
Модель симулює основні принципи взаємодії у спільноті організмів, враховуючи три ключові компоненти екосистеми: траву (виступає джерелом їжі для кроликів), кроликів (які живляться травою як основним ресурсом), та бур’ян (рослини, що конкурують із травою за ресурси, але не є основною їжею для кроликів). Ця екологічна модель дозволяє досліджувати такі концепції, як динаміка популяцій, взаємодія між хижаком і жертвою, а також вплив конкуренції між видами рослин.

### Керуючі параметри:
- **number-of-rabbits** визначає кількість агентів у середовищі моделювання, тобто, в даній моделі, початкова кількість кроликів.
- **birth-threshold** визначає кількість енергії, необхідної агенту для репродукції.
- **grass-grow-rate** визначає темп зростання трави з кожним ігровим тактом.
- **grass-energy** визначає кількість енергії, яку отримує кролик споживаючи траву.
- **weeds-grow-rate** визначає темп зростання бурʼяну в кожному ігровому такті.
- **weeds-energy** визначає кількість енергії, яку отримує кролик споживаючи бурʼян.

### Внутрішні параметри:
- **initial-energy**. Початкове значення енергії агента. Назначається випадковим шляхом для кожного агента (від 0 до 10).
- **energy**. Поточне значення енергії агента. Може відрізнятись у кожного агента в різні моменти модельного часу.
- **move-energy-loss-substrahend**. Кількість енергії, яка віднімається від енергії агента з кожним рухом в пошуку їжі. В поточній моделі це значення незмінне і дорівнює 0.5.
- **reproduction-energy-loss-coefficient**. Коефіцієнт втрати енергії агентом при репродукції. В даній моделі це значення незмінне і дорівнює 0.5 (при репродукції кролик втрачає половину своєї енергії).

### Змінимо код згідно варіанту

Обовʼязкові зміни:
- Додати можливість отруїтися при поїданні бур'янів (зазначена у внутрішніх параметрах, як певна вірогідність). Захворілий кролик не може харчуватися, переміщатися і розмножуватися, позначається іншим кольором і залишається хворим на 3 такти модельного часу. 
- Додати поділ кроликів на самців та самок. 
- Поява нових кроликів має вимагати не тільки ситості, а й здоров'я, та присутності в одній із сусідніх клітин іншого ситого здорового кролика протилежної статі. 
- Поява потомства відбувається із ймовірністю 50%.

**Додаткові зміни**:
- Додамо кожному кролику "вік" - кількість тактів, після яких кролик "помирає".
- Зробимо так, щоб тільки кролики жіночої статі могли народжувати. Кролики чоловічої статі тільки втрачають енергію.
- Зробимо так, щоб кролики жіночої статі могли народжувати 1 або 2 кролика (або 0).

Нові внутрішні параметри:
- **age**. Поточне значення віку кролика. Початкове значення 0, інкрементується з кожним тактом. Максимальне значення - 200 після чого кролик помирає.
- **health**. Поточне значення здоровʼя кролика. Початкове значення 3. При отруєнні змінюється на 0 і інкрементується до 3х з кожним тактом.
- **isMale**. Вказує на стать кролика. Призначається рандомно і не змінюється.<br>

Очевидно, що з такою конфігурацією популяція кроликів буде під загрозою.

### 1. Виконаємо експеримент з першої лабораторної про вплив почтакової кількості кроликів на полі на їхню подальшу популяцію
Нагадаємо, що початкова кількість кроликів не впливала на їхню подальшу популяцію і становила в середньому позначки 230.
Проведемо експеримент для значень 100-500, з кроком 100, усього 5 симуляцій.
Інші керуючі параметри мають значення за замовчуванням:
- **birth-threshold**: 15.
- **grass-grow-rate**: 15.
- **grass-energy**: 5.
- **weeds-grow-rate**: 0.
- **weeds-energy**: 0.

<table>
<thead>
<tr><th>Кількість кроликів</th><th>Середня популяція</th></tr>
</thead>
<tbody>
<tr><td>100</td><td>115</td></tr>
<tr><td>200</td><td>122</td></tr>
<tr><td>300</td><td>120</td></tr>
<tr><td>400</td><td>120</td></tr>
<tr><td>500</td><td>125</td></tr>
</tbody>
</table>

![Залежність середнього значення популяції кроликів від початкової кількості кроликів](populations-1_1.png)<br>

Наведено графік останньої симуляції, де **number-of-rabbits** дорівнює 500.
Графік наочно показує, що початкова кількість кроликів не впливає на середню популяцію, але в порівнянні з експериментом з попередньої лабораторної роботи, популяція кроликів майже вдвічі зменшилася.

### 2. Дослідимо, при якій конфігурації керуючих параметрів популяція кроликів становитиме в середньому 120.
Будемо змінювати значення **grass-grow-rate** починаючи з 10 з кроком 1. 
Встановимо також **weed-grow-rate**=5, щоб включити в експеримент вплив захворювання тварин на популяцію. 
Наступні параметри залишимо незмінними:
- **number-of-rabbits**: 150.
- **birth-threshold**: 15.
- **grass-energy**: 5.
- **weeds-energy**: 0.

<table>
<thead>
<tr><th>Темп росту трави</th><th>Середня популяція</th><th>Такт припинення популяції</th></tr>
</thead>
<tbody>
<tr><td>10</td><td>0</td><td>1075</td></tr>
<tr><td>11</td><td>0</td><td>1160</td></tr>
<tr><td>12</td><td>0</td><td>1893</td></tr>
<tr><td>13</td><td>0</td><td>1704</td></tr>
<tr><td>14</td><td>70</td><td>-</td></tr>
<tr><td>15</td><td>90</td><td>-</td></tr>
<tr><td>16</td><td>105</td><td>-</td></tr>
<tr><td>17</td><td>115</td><td>-</td></tr>
<tr><td>18</td><td>121</td><td>-</td></tr>
</tbody>
</table>

**Популяція кроликів при grass-grow-rate=18**<br>
![Вплив енергії, яку дає трава при споживанні на популяцію кроликів,5](populations-2_1.png)<br>

Оскільки фактор захворювання кроликів був включений в експеримент, **grass-grow-rate**=10 стало недостатньо для підтримки популяції кроликів.
Ба більше, ситуацію ускладнює фактор того, що бурʼян має негативний вплив на зростання трави (бурʼян має пріоритет над травою), а також додавання максимального віку кожній тварині.
По таблиці видно, що при значеннях **grass-grow-rate** 10-14 популяція кроликів з часом повністю припиняється.
Значення **grass-grow-rate**=18 вистачає для того, щоб підтримувати популяцію кроликів в середньому 120 осіб.<br>

[Посилання на nlogo файл](_model.nlogox)<br>

### Презентація
![Презентація](presentation.gif)<br>


### Код програми та зміни

Нижче наведено окремі блоки коду моделі NetLogo, в які були внесені зміни для реалізації логіки: "стать", "хвороба/отруєння", "вік" та "статеве розмноження".

#### 1. Оголошення нових змінних агентів
Додано властивості для відстеження стану здоров'я, статі та віку.

<pre>
```netlogo
breed [rabbits rabbit]

;; --- ЗМІНА ПО ВАРІАНТУ ---
;; Додано нові змінні (властивості) для кожного кролика:
;; health - рівень здоров'я (0 - хворий, 3 - здоровий)
;; isMale - стать (true - самець, false - самка)
;; age - вік у тактах (для реалізації смерті від старості)
rabbits-own [ energy health isMale age ]

</pre>
#### 2. Ініціалізація (Procedure: setup)
При створенні агентів тепер задаються початкові параметри статі та віку.
<pre>
to setup
  ;; ... (стандартний код очищення та росту трави) ...
  
  create-rabbits number [
    ;; --- ЗМІНА: ВСТАНОВЛЕННЯ ПОЧАТКОВИХ ПАРАМЕТРІВ ---
    set age 0       ;; Початковий вік
    set health 3    ;; Початкове здоров'я (3 - повністю здоровий)
    
    ;; Випадкове визначення статі
    set isMale one-of [ true false ]
    
    ;; Візуалізація статі (синій - самець, рожевий - самка)
    ifelse isMale
      [ set color blue ]
      [ set color pink ]
      
    setxy random-xcor random-ycor
    set energy random 10
  ]
  reset-ticks
end
</pre>
#### 3. Рух та лікування (Procedure: move)
Кролики рухаються тільки будучи здоровими. Хворі кролики стоять на місці і відновлюють здоров'я.
<pre>
to move
  ;; --- ЗМІНА: СТАРІННЯ ---
  ;; Інкремент віку з кожним тактом
  set age age + 1

  ;; --- ЗМІНА: ПЕРЕВІРКА ЗДОРОВ'Я ---
  ;; Рухатись та витрачати енергію можуть тільки здорові (health = 3)
  ifelse health = 3
  [
    ;; Відновлення кольору після хвороби (якщо був жовтим)
    if color = yellow
    [
      ifelse isMale
        [ set color blue ]
        [ set color pink ]
    ]
    
    ;; Стандартна логіка руху
    rt random 50
    lt random 50
    fd 1
    set energy energy - 0.5
  ]
  [
    ;; --- ЛОГІКА ХВОРОБИ ---
    ;; Якщо кролик хворий (health < 3), він не рухається, а лікується.
    ;; З кожним тактом здоров'я росте на 1, поки не стане 3.
    set health health + 1
  ]
end
</pre>
#### 4. Отруєння бур'янами (Procedure: eat-weeds)
Додано ймовірність отруєння при поїданні бур'янів.

Фрагмент коду

to eat-weeds
  if pcolor = violet
  [
    ;; --- ЗМІНА: ЙМОВІРНІСТЬ ОТРУЄННЯ ---
    ;; Реалізація шансу отруїтися (1 до 3)
    ifelse random 3 = 1
    [
      ;; Кролик отруївся:
      set color yellow   ;; Стає жовтим (маркування хвороби)
      set health 0       ;; Здоров'я падає до 0 (потрібно 3 такти на відновлення)
      set pcolor black   ;; Бур'ян зникає
      ;; Енергію при отруєнні кролик НЕ отримує
    ]
    [
      ;; Якщо не отруївся - їсть як завжди і отримує енергію
      set pcolor black
      set energy energy + weed-energy
    ]
  ]
end
### 5. Розмноження (Procedure: reproduce)
Реалізовано статеве розмноження. Вимагає пари (самець+самка), здоров'я та певної дистанції.

<pre>

to reproduce
  ;; --- ЗМІНА: УМОВИ РОЗМНОЖЕННЯ ---
  ;; Розмножуватись можуть лише ті, у кого:
  ;; 1. Достатньо енергії (> birth-threshold)
  ;; 2. Повне здоров'я (health = 3)
  if energy > birth-threshold and health = 3
  [
    ;; --- ЛОГІКА САМЦЯ ---
    ;; Шукає поруч (радіус 1) здорову ситу самку
    if isMale = true and any? rabbits in-radius 1 with [isMale = false and health = 3 and energy > birth-threshold]
    [
      ;; Самець втрачає енергію на парування, але не народжує
      set energy energy / 2
    ]

    ;; --- ЛОГІКА САМКИ ---
    ;; Шукає поруч здорового ситого самця
    if isMale = false and any? rabbits in-radius 1 with [isMale = true and health = 3 and energy > birth-threshold]
    [
      ;; Самка втрачає енергію
      set energy energy / 2
      
      ;; --- ЗМІНА: ЙМОВІРНІСТЬ 50% ---
      if one-of [ true false ] = true
      [
        ;; --- ЗМІНА: КІЛЬКІСТЬ ПОТОМСТВА (1 або 2) ---
        hatch one-of [1 2] [
          ;; Ініціалізація новонародженого
          set age 0
          set health 3
          set isMale one-of [ true false ]
          
          ifelse isMale
            [ set color blue ]
            [ set color pink ]
            
          ;; Розміщення
          setxy random-xcor random-ycor 
          set energy random 10
        ]
      ]
    ]
  ]
end
</pre>
#### 6. Смерть (Procedure: death)
Додано умову смерті від старості.

<pre>

to death
  ;; --- ЗМІНА: СМЕРТЬ ВІД СТАРОСТІ ---
  ;; Кролик помирає, якщо:
  ;; 1. Закінчилась енергія (energy < 0)
  ;; АБО
  ;; 2. Вік перевищив 200 тактів
  if energy < 0 or age > 200 [ die ]
end
</pre>
